<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Broker</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<link rel="stylesheet" href="css/bootstrap.css" />
	<link rel="stylesheet" href="css/my.css" />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/my.js"></script>
	<script src="js/bootstrap.min.js"> </script>

</head>
<body>

<div id="wrap">
	<header id="header" class="container">
		<div class="top-link">
			<a href="index.html" class="my_logout">Log Out</a>
		</div>
		<div class="my_title">Futures<a class="my_title_a">Broker</a></div>
		<nav id="nav-wrap">
			<ul id="nav">
				<li><a href="#" onclick="queryMarketClick();">Market</a></li>
				<li><a href="#" onclick="queryOrderClick();">My Order</a></li>
				<li><a href="#" onclick="queryBlotter();">Order Blotter</a></li>
			</ul>
		</nav>
	</header>

<section class="container home-content">
	<hr class="my_hr_T"/>

	<div> 
		<p class="my_marqueep">Futures Market : </p>
    	<marquee class="my_marquee" direction="right" scrollamount="5" onmouseover="this.stop()" onmouseout="this.start()">
    		<a href="#" onclick="futuresItemsSet(this);">RU</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">WR</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">UF</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">ME</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">FG</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">P</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">PVC</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">ER</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">WH</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     		<a href="#" onclick="futuresItemsSet(this);">WT</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">WS</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">C</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">JD</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">SR</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">RO</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">A</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">B</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">M</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">Y</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">CF</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    		<a href="#" onclick="futuresItemsSet(this);">AU</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		
        	<a href="#" onclick="futuresItemsSet(this);">CU</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        	<a href="#" onclick="futuresItemsSet(this);">AL</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        	
        	<a href="#" onclick="futuresItemsSet(this);">ZN</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        	<a href="#" onclick="futuresItemsSet(this);">PB</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        	<a href="#" onclick="futuresItemsSet(this);">AG</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        	<a href="#" onclick="futuresItemsSet(this);">SF</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
    	</marquee>
 	</div>

 	<hr/>


	<div class="two-thirds column">
		<h3>Futures Items: <span class="my_futuresitemDate" id="currentfuturesItemDate">MAY29</span><span class="my_futuresitemCategory" id="currentfuturesItem"> Bean</span></h3>	
	</div>
	<div class = "one-third column">
	</div>
</section>

<section class="container page-content my_containerwidth">
	<section id="main-content">
		<article class="eleven columns blog-post">

			<table class="table table-bordered table-hover table-striped my_ordertable">
				<thead>
					<tr>
						<th>Level</th>
						<th>Buy Vol</th>
						<th>Price</th>
						<th>Sell Vol</th>
						<th>Level</th>
					</tr>
				</thead>
				<tbody>
					<tr class="my_oddtr" id="up_3">
			    		<td></td>
						<td></td>
						<td>1254</td>
						<td>127</td>
						<td>3</td>
					</tr>
					<tr class="my_eventr" id="up_2">
			    		<td></td>
						<td></td>
						<td>1252</td>
						<td>32</td>
						<td>2</td>
					</tr>
					<tr class="my_oddtr" id="up_1">
			    		<td></td>
						<td></td>
						<td class="my_pricefilter">1250</td>
						<td>100</td>
						<td>1</td>
					</tr>
					<tr class="my_eventr" id="down_1">
			    		<td>1</td>
						<td>90</td>
						<td>1246</td>
						<td></td>
						<td></td>
					</tr>
					<tr class="my_oddtr" id="down_2">
			    		<td>2</td>
						<td>340</td>
						<td>1244</td>
						<td></td>
						<td></td>
					</tr>
					<tr class="my_eventr" id="down_3">
			    		<td>3</td>
						<td>187</td>
						<td>1240</td>
						<td></td>
						<td></td>
					</tr>
				</tbody>
			</table>

			<a hidden href="#" class="readmore">Purchase</a>
		</article>

	</section>

	<section id="sidebar" class="my_sidebarwidth">
		<div class="my_ld">
			<div class="my_hd">
				<h3 class="my_ad" id="ada_01"><a href="#" class="my_ada"><em class="my_em01"></em>Agri</a></h3>
				<h3 class="my_ad" id="ada_02"><a href="#" class="my_ada"><em class="my_em02"></em>Energy</a></h3>
            	<h3 class="my_ad" id="ada_03"><a href="#" class="my_ada"><em class="my_em03"></em>Metal</a></h3>
			</div>
			<div class="my_bd">
				<div style="display: block;" id="bd_01">
					<p class="my_clearfix">
	                    <a href="#" onclick="futuresItemsSet(this);">JR</a>
    	                <a href="#" onclick="futuresItemsSet(this);">C</a>
        	            <a href="#" onclick="futuresItemsSet(this);">WH</a>
            	        <a href="#" onclick="futuresItemsSet(this);">CF</a>
                	    <a href="#" onclick="futuresItemsSet(this);">SR</a>
                    	<a href="#" onclick="futuresItemsSet(this);">RO</a>
	                </p>
    	            <p class="my_clearfix">
        	            <a href="#" onclick="futuresItemsSet(this);">ER</a>
            	        <a href="#" onclick="futuresItemsSet(this);">P</a>
                	    <a href="#" onclick="futuresItemsSet(this);">WS</a>
                    	<a href="#" onclick="futuresItemsSet(this);">WT</a>
	                    <a href="#" onclick="futuresItemsSet(this);">A</a>
    	                <a href="#" onclick="futuresItemsSet(this);">B</a>
        	        </p>
            	    <p class="my_clearfix">
                	    <a href="#" onclick="futuresItemsSet(this);">M</a>
                    	<a href="#" onclick="futuresItemsSet(this);">Y</a>
	                    <a href="#" onclick="futuresItemsSet(this);">JD</a>
            	    </p>
				</div>
				<div style="display: none;" id="bd_02">
              		<p class="my_clearfix">
                    	<a href="#" onclick="futuresItemsSet(this);">LLDPE</a>
                    	<a href="#" onclick="futuresItemsSet(this);">PVC</a>
    	                <a href="#" onclick="futuresItemsSet(this);">PTA</a>
	                    <a href="#" onclick="futuresItemsSet(this);">RU</a>
        	            <a href="#" onclick="futuresItemsSet(this);">FU</a>
            	        <a href="#" onclick="futuresItemsSet(this);">WR</a>
                	</p>
	                <p class="my_clearfix">
    	                <a href="#" onclick="futuresItemsSet(this);">ME</a>
        	            <a href="#" onclick="futuresItemsSet(this);">J</a>
            	        <a href="#" onclick="futuresItemsSet(this);">I</a>
                	    <a href="#" onclick="futuresItemsSet(this);">BU</a>
                    	<a href="#" onclick="futuresItemsSet(this);">FG</a>
	                    <a href="#" onclick="futuresItemsSet(this);">TC</a>
    	            </p>
        	    </div>
            	<div style="display: none;" id="bd_03">
                	<p class="my_clearfix">
                    	<a href="#" onclick="futuresItemsSet(this);">CU</a>
	                    <a href="#" onclick="futuresItemsSet(this);">AL</a>
    	                <a href="#" onclick="futuresItemsSet(this);">ZN</a>
        	            <a href="#" onclick="futuresItemsSet(this);">PB</a>
            	        <a href="#" onclick="futuresItemsSet(this);">SF</a>
                	    <a href="#" onclick="futuresItemsSet(this);">RB</a>
	                </p>
    	            <p class="my_clearfix">
        	            <a href="#" onclick="futuresItemsSet(this);">AU</a>
            	        <a href="#" onclick="futuresItemsSet(this);">AG</a>
                	</p>
            	</div>
			</div>
		</div>

	<hr class="my_nullhr"/>

	<div hidden="" id="marketdepthTable">
		<h4 class="subtitle my_marketsubtitle">Market Depth</h4>
		<div class="listbox1">
			<ul>
				<li>
					<a href="#" class="my_fund" id="futuresItemsCategory">AU</a>
					<a href="#" class="my_fundType">Futures Item</a>
				</li>
				<li>
					<div class="from-group my_timelistlabel my_fund my_cancelorderdropdown">
      					<select class="form-control my_timelistselect" id="futuresItemsMonth">
         					<option value=1>JAN</option>
         					<option value=2>FEB</option>
         					<option value=3>MAR</option>
         					<option value=4>APR</option>
         					<option value=5>MAY</option>
         					<option value=6>JUN</option>
         					<option value=7>JUL</option>
         					<option value=8>AUG</option>
         					<option value=9>SEP</option>
         					<option value=10>OCT</option>
         					<option value=11>NOV</option>
         					<option value=12>DEC</option>
      					</select>
            		</div>
					<a href="#" class="my_fundType">Month</a>
				</li>
				<li>
					<input class="my_fund my_cancelorderinput" maxlength="2" id="futuresItemsDate"/>
					<a href="#" class="my_fundType">Date</a>
				</li>
				<li class="my_fundli"> 
					<button class="my_fundinjectionconfirm" onclick="queryMarketDepthClick();">View</button>
				</li>
			</ul>
		</div>
	</div>

		<hr class="my_nullhr"/><hr class="my_nullhr"/><hr class="my_nullhr"/><hr class="my_nullhr"/>
		<hr class="my_nullhr"/><hr class="my_nullhr"/><hr class="my_nullhr"/>

	</section>
</section>

<section class="container page-content">
	<hr class="my_blankhr"/><hr class="my_blankhr"/>
</section>


<footer id="footer" align="center" class="my_footer">
	<div class="container footer-in">
		<p>CopyRights@</p>
	</div>
</footer>

</div>

</body>
</html>

<script type="text/javascript">

  	//////////////////////////////////  8888 8888 8888 
  	var myurl = "https://localhost:8443/BrokerGateway/rest/";
  	var orderType = "";
	
	function futuresItemsSet(items){
		//alert($(items).text());
		if ($("#marketdepthTable").is(":hidden")) $("#marketdepthTable").show(1000);
		$("#futuresItemsCategory").text($(items).text());
	}

	function validateDate(year, month, date){
		var minDate = 1;
		var maxDate = 31;
		if ((month == 1) || (month == 3) || (month == 5) || (month == 7) || (month == 8) || (month == 10) || (month == 12)) maxDate = 31;
		else if ((month == 4) ||(month == 6) ||(month == 9) ||(month == 11)) maxDate = 30;
		else{
			if ((year % 400) == 0) maxDate = 29;
			else if ((year % 100) == 0) maxDate = 28;
			else if ((year % 4) == 0) maxDate = 29;
			else maxDate = 28;
		}
		for (var i = 0; i < date.length; ++i)
			if (!((date.charAt(i) <= '9') && (date.charAt(i) >= '0')))
				return 0;
		var curDate = date * 1;
		if ((curDate >= minDate) && (curDate <= maxDate)) return curDate;
		else return 0;
	}

	function getMarketDepth(items, periods){
		$.ajax({
			url : myurl + "OrderBook/product=" + items + "&period=" + periods,
			type : "GET",
			success : function(msg){
				var obj = eval(msg);
				//console.log(obj);
				if (jQuery.isEmptyObject(obj)){
					$("#currentfuturesItem").text(" " + items);
                	$("#currentfuturesItemDate").text(periods);
	               	for (var i = 1; i < 4; ++i){
	               		$("#up_" + i).children().eq(2).text("--");
                		$("#up_" + i).children().eq(3).text("");
                		$("#up_" + i).children().eq(4).text("");

                		$("#down_" + i).children().eq(2).text("--");
                		$("#down_" + i).children().eq(1).text("");
                		$("#down_" + i).children().eq(0).text("");
	               	}
                }
                else{
                	$("#currentfuturesItem").text(" " + items);
                	$("#currentfuturesItemDate").text(periods);
                	var max_1 = obj.length;
                	var max_0;
                	for (max_0 = 0; max_0 < max_1; ++max_0)
                		if (obj[max_0].side == 0){
                			break;
                		}
                	var pnt = 0;
                	for (var i = max_0; i < max_1; ++i){
                		pnt++;
                		$("#down_" + pnt).children().eq(2).text(obj[i].price);
                		$("#down_" + pnt).children().eq(1).text(obj[i].quantity);
                		$("#down_" + pnt).children().eq(0).text(pnt);
                		
                	}
                	while (pnt < 3){
                		pnt++;
                		$("#down_" + pnt).children().eq(2).text("--");
                		$("#down_" + pnt).children().eq(1).text("");
                		$("#down_" + pnt).children().eq(0).text("");                		
                	}

                	var pnt = 0;
                	for (var i = max_0 - 1; i >= 0; --i){
                		pnt++;
                		$("#up_" + pnt).children().eq(2).text(obj[i].price);
                		$("#up_" + pnt).children().eq(3).text(obj[i].quantity);
                		$("#up_" + pnt).children().eq(4).text(pnt);
                	}
                	while (pnt < 3){
                		pnt++;
                		$("#up_" + pnt).children().eq(2).text("--");
                		$("#up_" + pnt).children().eq(3).text("");
                		$("#up_" + pnt).children().eq(4).text("");
                	}
                }
			}
		});
	}

	function queryMarketDepthClick(){
		var cur_year = new Date().getFullYear();
		var cur_month = $("#futuresItemsMonth").val();
		var cur_date = $("#futuresItemsDate").val();
		if (cur_date == "") alert("Please Input The Date!");
		else{
		 	cur_date = validateDate(cur_year, cur_month, cur_date);		
			if (cur_date == 0) alert("Illegal Date");
			else{
				var cur_period = $("#futuresItemsMonth").children().eq($("#futuresItemsMonth").val() - 1).text();
				if (cur_date < 10) cur_period += ("0" + cur_date);
				else cur_period += ("" + cur_date);
				//console.log(cur_period);
				getMarketDepth($("#futuresItemsCategory").text(), cur_period);
			}
		}

	}

	function queryMarketClick(){
		window.location.href = "broker.html";
	}

	function queryOrderClick(){
		window.location.href = "brokerOrder.html";
	}

	function queryBlotter(){
		window.location.href = "brokerOrderBlotter.html";
	}

	$("#ada_01").hover(function(){
		$("#ada_01").css("background-color", "rgba(255, 255, 255, 1)");
    	$("#ada_02").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_03").css("background-color", "rgba(240, 240, 240, 1)");

    	$("#ada_02").css("border-top-color", "rgba(221, 221, 221, 1)");
    	$("#ada_02").css("border-bottom-color", "rgba(240, 240, 240, 1)");

    	$("#ada_01").css("border-right-color", "rgba(255, 255, 255, 1)");
    	$("#ada_02").css("border-right-color", "rgba(221, 221, 221, 1)");
    	$("#ada_03").css("border-right-color", "rgba(221, 221, 221, 1)");

    	$("#bd_01").css("display", "block");
    	$("#bd_02").css("display", "none");
    	$("#bd_03").css("display", "none");
	});

	$("#ada_02").hover(function(){
		$("#ada_01").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_02").css("background-color", "rgba(255, 255, 255, 1)");
    	$("#ada_03").css("background-color", "rgba(240, 240, 240, 1)");

    	$("#ada_02").css("border-top-color", "rgba(221, 221, 221, 1)");
    	$("#ada_02").css("border-bottom-color", "rgba(221, 221, 221, 1)");

    	$("#ada_01").css("border-right-color", "rgba(221, 221, 221, 1)");
    	$("#ada_02").css("border-right-color", "rgba(255, 255, 255, 1)");
    	$("#ada_03").css("border-right-color", "rgba(221, 221, 221, 1)");

    	$("#bd_01").css("display", "none");
    	$("#bd_02").css("display", "block");
    	$("#bd_03").css("display", "none");
	});

	$("#ada_03").hover(function(){
		$("#ada_01").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_02").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_03").css("background-color", "rgba(255, 255, 255, 1)");

    	$("#ada_02").css("border-top-color", "rgba(240, 240, 240, 1)");
    	$("#ada_02").css("border-bottom-color", "rgba(221, 221, 221, 1)");

    	$("#ada_01").css("border-right-color", "rgba(221, 221, 221, 1)");
    	$("#ada_02").css("border-right-color", "rgba(221, 221, 221, 1)");
    	$("#ada_03").css("border-right-color", "rgba(255, 255, 255, 1)");

    	$("#bd_01").css("display", "none");
    	$("#bd_02").css("display", "none");
    	$("#bd_03").css("display", "block");
	});

	$(window).load(function() {
    	$('#slider').nivoSlider();
    });

	function addredis(){
		/*var marketdepthInfo = [{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 20,
			"price" : 28,
			"side" : 0,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		},
		{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 30,
			"price" : 30,
			"side" : 1,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		},
		{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 40,
			"price" : 25,
			"side" : 0,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		},
		{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 70,
			"price" : 33,
			"side" : 1,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		},
		{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 40,
			"price" : 18,
			"side" : 0,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		},
		{
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 25,
			"price" : 45,
			"side" : 1,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		}
		];*/

		var marketdepthInfo = {
			"orderID" : "6",
			"orderType" : "limit",
			"product" : "AU",
			"period" : "OCT13",
			"quantity" : 25,
			"price" : 45,
			"side" : 1,
			"orderTime" : "2016-06-03 11:22:33",
			"trader" : "qsk",
			"traderCompany" : "QSK Gateway"
		};
		$.ajax({
              url : myurl + "Order",
              type : "POST",
              contentType: "application/json",
              data: JSON.stringify(marketdepthInfo),
              success : function(msg){
              	console.log("yes");	
              }
		});
	}

	function getredis(){
		console.log("in");
		$.ajax({
				url : myurl + "OrderBook/product=AU&period=OCT13",
				type : "GET",
				success : function(msg){
					var obj = eval(msg);
					console.log(obj);
				}
		});
	}

    $(document).ready(function(){
    	//addredis();
    	//getredis();
    	getMarketDepth("AU", "OCT13");

    	$("#ada_02").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_03").css("background-color", "rgba(240, 240, 240, 1)");
    	$("#ada_01").css("border-bottom-color", "rgba(240, 240, 240, 1)");
    	$("#ada_03").css("border-top-color", "rgba(240, 240, 240, 1)");
    	$("#ada_02").css("border-bottom-color", "rgba(240, 240, 240, 1)");

    	$("#ada_02").css("border-right-color", "rgba(221, 221, 221, 1)");
    	$("#ada_03").css("border-right-color", "rgba(221, 221, 221, 1)");

    });
		
</script>